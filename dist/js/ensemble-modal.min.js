/*! * loltgt/ensemble.Modal * * @version 0.0.1 * @link https://github.com/loltgt/ensemble-modal * @copyright Copyright (C) Leonardo Laureti * @license MIT License */!function(t,e){if("function"==typeof define&&define.amd)define(["exports"],e);else if("undefined"!=typeof exports)e(exports);else{var s={exports:{}};e(s.exports),t.ensemble=s.exports}}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,(function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Modal=void 0;const e="undefined"==typeof Symbol?0:Symbol,s=/html|head|body|meta|link|style|script/i,o=/(<(html|head|body|meta|link|style|script)*>)/i;const n=/html|head|body|meta|link|style|script/i,i=/attributes|classList|innerHTML|outerHTML|nodeName|nodeType/;class Compo extends class _composition{_renderer(){delete this._element,delete this._renderer}install(t,e){return"function"==typeof e&&e.call(this,this[this._ns]),!!t.appendChild(this[this._ns])}uninstall(t,e){return"function"==typeof e&&e.call(this,this[this._ns]),!!t.removeChild(this[this._ns])}up(t,e){return"function"==typeof e&&e.call(this,this[this._ns]),!!t.replaceWith(this[this._ns])}append(t){const e=this._ns;return!!this[e].appendChild(t[e])}prepend(t){const e=this._ns;return!!this[e].prependChild(t[e])}remove(t){const e=this._ns;return!!this[e].removeChild(t[e])}inject(t){if(t instanceof Element==0||s.test(t.tagName)||o.test(t.innerHTML))throw new Error("ensemble.Compo error: The remote object could not be resolved into a valid node.");return this.empty(),!!this[this._ns].appendChild(t)}empty(){for(;this.first;)this.remove(this.first)}get children(){return Array.prototype.map.call(this[this._ns].children,(t=>t.__compo))}get first(){const t=this._ns;return this[t].firstElementChild?this[t].firstElementChild.__compo:null}get last(){const t=this._ns;return this[t].lastElementChild?this[t].lastElementChild.__compo:null}}{constructor(t,e,s,o,r,l){if(!new.target)throw"ensemble.Compo error: Bad invocation, must be called with new.";super();const h=this._ns="_"+t,a=e?e.toString():"div";if(n.test(e))throw new Error(`ensemble.Compo error: The tag name provided ('${a}') is not a valid name.`);const c=this[h]=this._element(t,a,s,o,r,l);if(this.__Compo=!0,this[h].__compo=this,o&&"object"==typeof o)for(const e in o){const s=e.toString();if(i.test(s))throw new Error(`ensemble.Compo error: The property name provided ('${s}') is not a valid name.`);if(0===s.indexOf("on")&&o[s]&&"function"==typeof o[s])c[s]=o[s].bind(this);else if("object"!=typeof o[s])c[s]=o[s];else if("children"==s&&"object"==typeof o[s]&&o[s].length)for(const e of o.children){const s=e.tag,o=e.name,n=e.props;this.append(new Compo(t,s,o,n))}}if(s){const e=c.className;c.className="","string"==typeof s?c.className=t+"-"+s:"object"==typeof s&&(c.className=s.map((e=>t+"-"+e)).join(" ")),e&&(c.className+=" "+e)}this._renderer()}_element(t,e,s,o,n,i){return i?document.createElementNS(e,[...i,...n]):document.createElement(e,n)}hasAttr(t){return this[this._ns].hasAttribute(t)}getAttr(t){return this[this._ns].getAttribute(t)}setAttr(t,e){this[this._ns].setAttribute(t,e)}delAttr(t){this[this._ns].removeAttribute(t)}getStyle(t){return window.getComputedStyle(this[this._ns])[t]}show(){this[this._ns].hidden=!1}hide(){this[this._ns].hidden=!0}enable(){this[this._ns].disabled=!1}disable(){this[this._ns].disabled=!0}get node(){return console.warn("ensemble.Compo","Direct access to the node is strongly discouraged."),this[this._ns]}get parent(){const t=this._ns;return this[t].parentElement&&"__compo"in this[t].parentElement?this[t].parentElement.__compo:null}get previous(){const t=this._ns;return this[t].previousElementSibling?this[t].previousElementSibling.__compo:null}get next(){const t=this._ns;return this[t].nextElementSibling?this[t].nextElementSibling.__compo:null}get classList(){return this[this._ns].classList}static isCompo(t){return e?e.for(t)===e.for(Compo.prototype):t&&"object"==typeof t&&"__Compo"in t}get[e.toStringTag](){return"ensemble.Compo"}}class Data{constructor(t,e){if(!new.target)throw"ensemble.Data error: Bad invocation, must be called with new.";e&&"object"==typeof e&&Object.assign(this,{},e);const s=this._ns="_"+t;this.__Data=!0,this[s]={ns:t}}compo(t,e,s,o=!1,n=!1,i=!1){const r=this[this._ns].ns;let l;return l=o?{ns:r,tag:t,name:e,props:s,fresh:n,stale:i}:new Compo(r,t,e,s),n&&"function"==typeof n&&(l.fresh=s.onfresh=n),i&&"function"==typeof i&&(l.stale=s.onstale=i),l}async render(t){const e=this._ns;this[e][t]&&this[e][t].rendered||(this[e][t]={rendered:!0,fresh:this[t].fresh,stale:this[t].stale,params:this[t]},this[t]=new Compo(this[t].ns,this[t].tag,this[t].name,this[t].props)),this[e][t].fresh()}async stale(t){const e=this._ns;this[e][t]&&this[e][t].rendered&&this[e][t].stale()}async reflow(t,e){const s=this._ns;e?this[s][t]=this.compo(this[s][t].params.ns,this[s][t].params.name,this[s][t].params.props):this[s][t]&&this[s][t].rendered&&this[s][t].fresh()}static isData(t){return e?e.for(t)===e.for(Data.prototype):t&&"object"==typeof t&&"__Data"in t}get[e.toStringTag](){return"ensemble.Data"}}class Event{constructor(t,e,s){if(!new.target)throw"ensemble.Event error: Bad invocation, must be called with new.";const o=this._ns="_"+t;s=(Compo.isCompo(s)?s.node:s)||document,this.__Event=!0,this[o]={name:e,node:s}}add(t,e=!1){this[this._ns].node.addEventListener(this[this._ns].name,t,e)}remove(t){this[this._ns].node.removeEventListener(this[this._ns].name,t)}static isEvent(t){return e?e.for(t)===e.for(Event.prototype):t&&"object"==typeof t&&"__Event"in t}get[e.toStringTag](){return"ensemble.Event"}}t.Modal=class Modal extends class base{constructor(){const t="ensemble"+(new.target&&new.target.name?"."+new.target.name:"");let e,s;if(arguments.length>1?(e=arguments[0],s=arguments[1]):s=arguments[0],s&&"object"!=typeof s)throw new TypeError(`${t} error: The passed argument 'options' is not of type Object.`);if(e&&"object"!=typeof e)throw new TypeError(`${t} error: The passed argument 'element' is not of type Object.`);this._bindings(),this.options=this.defaults(this._defaults(),s),Object.freeze(this.options),this.element=e}defaults(t,e){const s={};for(const o in t)null!=t[o]&&"object"==typeof t[o]?s[o]=Object.assign(t[o],e[o]):s[o]=void 0!==e[o]?e[o]:t[o];return s}compo(t,e,s){return null!=t?new Compo(this.options.ns,t,e,s):Compo}data(t){return null!=t?new Data(this.options.ns,t):Data}event(t,e){return"string"==typeof t?new Event(this.options.ns,t,e):t?(t.preventDefault(),void t.target.blur()):Event}selector(t,e,s=!1){return e=e||document,s?e.querySelectorAll(t):e.querySelector(t)}appendNode(t,e){return!!t.appendChild(e)}prependNode(t,e){return!!t.prependChild(e)}removeNode(t,e){return!!t.removeChild(e)}cloneNode(t,e=!1){return t.cloneNode(e)}hasAttr(t,e){return t.hasAttribute(e)}getAttr(t,e){return t.getAttribute(e)}setAttr(t,e,s){t.setAttribute(e,s)}delAttr(t,e){t.removeAttribute(e)}binds(t){const e=this;return function(s){t.call(e,s,this)}}delay(t,e,s){const o=e?this.timing(e):0;setTimeout(t,o||s)}timing(t,e="transitionDuration"){let s=Compo.isCompo(t)?t.getStyle(e):window.getComputedStyle(t)[e];return s&&(s=s.indexOf("s")?1e3*parseFloat(s):parseInt(s)),s||0}}{_defaults(){return{ns:"modal",root:"body",className:"modal",fx:!0,windowed:!1,cloning:!0,backClose:!0,keyboard:!0,close:{onclick:this.close,innerText:"Ã—",ariaLabel:"Close"},onOpen:function(){},onClose:function(){},onShow:function(){},onHide:function(){},onContent:function(){}}}_bindings(){this.open=this.binds(this.open),this.close=this.binds(this.close),this.backx=this.binds(this.backx),this.keyboard=this.binds(this.keyboard)}constructor(){if(!new.target)throw"ensemble.Modal error: Bad invocation, must be called with new.";super(...arguments)}generator(){const t=this.options,e=this.box=this.data({onclick:!1}),s=this.box.wrap=this.compo("dialog",!1,{className:"object"==typeof t.className?t.className.join(" "):t.className,hidden:!0,ariaModal:!0,role:"dialog",onclick:function(){e.onclick&&"function"==typeof e.onclick&&e.onclick.apply(this,arguments)}}),o=this.cnt=this.compo(!1,"content"),n=this.compo("button",["button","close"],t.close);s.append(o),t.windowed?(s.classList.add(t.ns+"-windowed"),o.append(n)):s.append(n),t.backClose&&(this.box.onclick=this.backx),t.fx&&s.classList.add(t.ns+"-fx"),this.root=this.selector(t.root),this.built=!0}populate(t){if(console.log("ensemble.Modal","populate()",t),!this.element)return;const e=this.content(this.element);this.cnt.append(e)}resume(t){console.log("ensemble.Modal","resume()",t)}content(t,e){const s=this.options,o=this.compo(!1,"object");let n=(e=void 0!==e?e:s.cloning)?this.cloneNode(t,!0):t;return s.onContent.call(this,this,o,n),n&&o.inject(n),o}destroy(){const t=this.root,e=this.box.wrap;this.removeNode(t,e),this.built=!1}open(t,e){if(this.event(t),this.opened)return;const s=this.options;this.built?this.resume(e):(this.generator(),this.populate(e)),this.opened=!0,s.onOpen.call(this,this,e,t),this.show(e),s.keyboard&&this.event("keydown").add(this.keyboard),console.log("ensemble.Modal","open()",this)}close(t,e){if(this.event(t),!this.opened)return;const s=this.options;this.opened=!1,s.onClose.call(this,this,e,t),this.hide(e),s.keyboard&&this.event("keydown").remove(this.keyboard),console.log("ensemble.Modal","close()",this)}show(t){const e=this.options,s=this.root;this.box;const o=this.box.wrap;o.install(s),this.delay((function(){o.show(),e.onShow.call(self,self,t)}))}hide(t){const e=this.options,s=this.root;this.box;const o=this.box.wrap;o.hide(),this.delay((function(){o.uninstall(s),e.onHide.call(self,self,t)}),o,300)}backx(t){this.event(t);const e=t.target,s=e.parentElement,o=this.options.ns;var n;if(((n=new RegExp(o+"-content")).test(e.className)||n.test(s.className))&&(console.log("ensemble.Modal","backx()","outside cropbox area",":then: close",s,e),this.close(t)),!(n=new RegExp(o+"-object")).test(e.className))return void console.log("ensemble.Modal","backx()","outside cropbox area",":then: skip",s,e);const i=e.firstElementChild,r=i.offsetWidth,l=i.offsetHeight,h=e.offsetTop,a=e.offsetLeft,c=e.offsetWidth,d=e.offsetHeight,p=event.x,m=event.y,u=(d-l)/2,f=(c-r)/2,b=u+l,_=f+r;console.log("ensemble.Modal","backx()","coords",{x:p,y:m},{target_t:h,target_l:a,target_w:c,target_h:d},{crop_t:u,crop_r:_,crop_b:b,crop_l:f}),(m>h||p>a||p<c||m<d)&&(m<u||p>_||m>b||p<f)&&(console.log("ensemble.Modal","backx()","outside cropbox area",":then: close",s,e),this.close(t))}keyboard(t){this.event(t);27==(t.keyCode||0)&&this.close(t)}}}));