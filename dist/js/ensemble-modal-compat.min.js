/*! * loltgt/ensemble.Modal (compat) * * @version 0.0.2 * @link https://github.com/loltgt/ensemble-modal * @copyright Copyright (C) Leonardo Laureti * @license MIT License */!function(t,r){if("function"==typeof define&&define.amd)define(["exports"],r);else if("undefined"!=typeof exports)r(exports);else{var o={exports:{}};r(o.exports),t.ensemble=o.exports}}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,(function(t){"use strict";function asyncGeneratorStep(t,r,o,i,a,c,l){try{var u=t[c](l),h=u.value}catch(t){return void o(t)}u.done?r(h):Promise.resolve(h).then(i,a)}Object.defineProperty(t,"__esModule",{value:!0}),t.Modal=void 0;var r=function(t){var r,o=Object.prototype,i=o.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",l=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var a=r&&r.prototype instanceof Generator?r:Generator,c=Object.create(a.prototype),l=new Context(i||[]);return c._invoke=function makeInvokeMethod(t,r,o){var i=h;return function invoke(a,c){if(i===d)throw new Error("Generator is already running");if(i===y){if("throw"===a)throw c;return doneResult()}for(o.method=a,o.arg=c;;){var l=o.delegate;if(l){var u=maybeInvokeDelegate(l,o);if(u){if(u===v)continue;return u}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(i===h)throw i=y,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);i=d;var m=tryCatch(t,r,o);if("normal"===m.type){if(i=o.done?y:p,m.arg===v)continue;return{value:m.arg,done:o.done}}"throw"===m.type&&(i=y,o.method="throw",o.arg=m.arg)}}}(t,o,l),c}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var m={};define(m,c,(function(){return this}));var _=Object.getPrototypeOf,b=_&&_(_(values([])));b&&b!==o&&i.call(b,c)&&(m=b);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(m);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,a,c,l){var u=tryCatch(t[o],t,a);if("throw"!==u.type){var h=u.arg,p=h.value;return p&&"object"==typeof p&&i.call(p,"__await")?r.resolve(p.__await).then((function(t){invoke("next",t,c,l)}),(function(t){invoke("throw",t,c,l)})):r.resolve(p).then((function(t){h.value=t,c(h)}),(function(t){return invoke("throw",t,c,l)}))}l(u.arg)}var o;this._invoke=function enqueue(t,i){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,i,r,o)}))}return o=o?o.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(t,o){var i=t.iterator[o.method];if(i===r){if(o.delegate=null,"throw"===o.method){if(t.iterator.return&&(o.method="return",o.arg=r,maybeInvokeDelegate(t,o),"throw"===o.method))return v;o.method="throw",o.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var a=tryCatch(i,t.iterator,o.arg);if("throw"===a.type)return o.method="throw",o.arg=a.arg,o.delegate=null,v;var c=a.arg;return c?c.done?(o[t.resultName]=c.value,o.next=t.nextLoc,"return"!==o.method&&(o.method="next",o.arg=r),o.delegate=null,v):c:(o.method="throw",o.arg=new TypeError("iterator result is not an object"),o.delegate=null,v)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var o=t[c];if(o)return o.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,l=function next(){for(;++a<t.length;)if(i.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=r,next.done=!0,next};return l.next=l}}return{next:doneResult}}function doneResult(){return{value:r,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,define(g,"constructor",GeneratorFunctionPrototype),define(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,l,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,i,a,c){void 0===c&&(c=Promise);var l=new AsyncIterator(wrap(r,o,i,a),c);return t.isGeneratorFunction(o)?l:l.next().then((function(t){return t.done?t.value:l.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,c,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=[];for(var o in t)r.push(o);return r.reverse(),function next(){for(;r.length;){var o=r.pop();if(o in t)return next.value=o,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(resetTryEntry),!t)for(var o in this)"t"===o.charAt(0)&&i.call(this,o)&&!isNaN(+o.slice(1))&&(this[o]=r)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var o=this;function handle(i,a){return l.type="throw",l.arg=t,o.next=i,a&&(o.method="next",o.arg=r),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var c=this.tryEntries[a],l=c.completion;if("root"===c.tryLoc)return handle("end");if(c.tryLoc<=this.prev){var u=i.call(c,"catchLoc"),h=i.call(c,"finallyLoc");if(u&&h){if(this.prev<c.catchLoc)return handle(c.catchLoc,!0);if(this.prev<c.finallyLoc)return handle(c.finallyLoc)}else if(u){if(this.prev<c.catchLoc)return handle(c.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return handle(c.finallyLoc)}}}},abrupt:function(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o];if(a.tryLoc<=this.prev&&i.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var c=a;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var l=c?c.completion:{};return l.type=t,l.arg=r,c?(this.method="next",this.next=c.finallyLoc,v):this.complete(l)},complete:function(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),v},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),v}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var i=o.completion;if("throw"===i.type){var a=i.arg;resetTryEntry(o)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,o,i){return this.delegate={iterator:values(t),resultName:o,nextLoc:i},"next"===this.method&&(this.arg=r),v}},t}("object"==typeof module?module.exports:{});try{regeneratorRuntime=r}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(i,a){var c=t.apply(r,o);function _next(t){asyncGeneratorStep(c,i,a,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,i,a,_next,_throw,"throw",t)}_next(void 0)}))}}function _extends(){return _extends=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(t[i]=o[i])}return t},_extends.apply(this,arguments)}function _toConsumableArray(t){return function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}(t)||function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||_unsupportedIterableToArray(t)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var i=0,a=function F(){};return{s:a,n:function n(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,l=!0,u=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return l=t.done,t},e:function e(t){u=!0,c=t},f:function f(){try{l||null==o.return||o.return()}finally{if(u)throw c}}}}function _unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return _arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(t,r):void 0}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,i=new Array(r);o<r;o++)i[o]=t[o];return i}function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,i=_getPrototypeOf(t);if(r){var a=_getPrototypeOf(this).constructor;o=Reflect.construct(i,arguments,a)}else o=i.apply(this,arguments);return _possibleConstructorReturn(this,o)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}var o="undefined"==typeof Symbol?0:Symbol,i=/html|head|body|meta|link|style|script/i,a=/(<(html|head|body|meta|link|style|script)*>)/i,c=/html|head|body|meta|link|style|script/i,l=/attributes|classList|innerHTML|outerHTML|nodeName|nodeType/,u=function(t,r){_inherits(Compo,t);var i=_createSuper(Compo);function Compo(t,r,o,a,u,h){var p;if(_classCallCheck(this,Compo),!(this instanceof Compo?this.constructor:void 0))throw"ensemble.Compo error: Bad invocation, must be called with new.";var d=(p=i.call(this))._ns="_"+t,y=r?r.toString():"div";if(c.test(r))throw new Error("ensemble.Compo error: The tag name provided ('".concat(y,"') is not a valid name."));var v=p[d]=p._element(t,y,o,a,u,h);if(p.__Compo=!0,p[d].__compo=_assertThisInitialized(p),a&&"object"==_typeof(a))for(var m in a){var _=m.toString();if(l.test(_))throw new Error("ensemble.Compo error: The property name provided ('".concat(_,"') is not a valid name."));if(0===_.indexOf("on")&&a[_]&&"function"==typeof a[_])v[_]=a[_].bind(_assertThisInitialized(p));else if("object"!=_typeof(a[_]))v[_]=a[_];else if("children"==_&&"object"==_typeof(a[_])&&a[_].length){var b,g=_createForOfIteratorHelper(a.children);try{for(g.s();!(b=g.n()).done;){var k=b.value,w=k.tag,x=k.name,C=k.props;p.append(new Compo(t,w,x,C))}}catch(t){g.e(t)}finally{g.f()}}}if(o){var E=v.className;v.className="","string"==typeof o?v.className=t+"-"+o:"object"==_typeof(o)&&(v.className=o.map((function(r){return t+"-"+r})).join(" ")),E&&(v.className+=" "+E)}return p._renderer(),p}return _createClass(Compo,[{key:"_element",value:function _element(t,r,o,i,a,c){return c?document.createElementNS(r,[].concat(_toConsumableArray(c),_toConsumableArray(a))):document.createElement(r,a)}},{key:"hasAttr",value:function hasAttr(t){return this[this._ns].hasAttribute(t)}},{key:"getAttr",value:function getAttr(t){return this[this._ns].getAttribute(t)}},{key:"setAttr",value:function setAttr(t,r){this[this._ns].setAttribute(t,r)}},{key:"delAttr",value:function delAttr(t){this[this._ns].removeAttribute(t)}},{key:"getStyle",value:function getStyle(t){return window.getComputedStyle(this[this._ns])[t]}},{key:"show",value:function show(){this[this._ns].hidden=!1}},{key:"hide",value:function hide(){this[this._ns].hidden=!0}},{key:"enable",value:function enable(){this[this._ns].disabled=!1}},{key:"disable",value:function disable(){this[this._ns].disabled=!0}},{key:"node",get:function get(){return console.warn("ensemble.Compo","Direct access to the node is strongly discouraged."),this[this._ns]}},{key:"parent",get:function get(){var t=this._ns;return this[t].parentElement&&"__compo"in this[t].parentElement?this[t].parentElement.__compo:null}},{key:"previous",get:function get(){var t=this._ns;return this[t].previousElementSibling?this[t].previousElementSibling.__compo:null}},{key:"next",get:function get(){var t=this._ns;return this[t].nextElementSibling?this[t].nextElementSibling.__compo:null}},{key:"classList",get:function get(){return this[this._ns].classList}},{key:r,get:function get(){return"ensemble.Compo"}}],[{key:"isCompo",value:function isCompo(t){return o?o.for(t)===o.for(Compo.prototype):t&&"object"==_typeof(t)&&"__Compo"in t}}]),Compo}(function(){function _composition(){_classCallCheck(this,_composition)}return _createClass(_composition,[{key:"_renderer",value:function _renderer(){delete this._element,delete this._renderer}},{key:"install",value:function install(t,r){return"function"==typeof r&&r.call(this,this[this._ns]),!!t.appendChild(this[this._ns])}},{key:"uninstall",value:function uninstall(t,r){return"function"==typeof r&&r.call(this,this[this._ns]),!!t.removeChild(this[this._ns])}},{key:"up",value:function up(t,r){return"function"==typeof r&&r.call(this,this[this._ns]),!!t.replaceWith(this[this._ns])}},{key:"append",value:function append(t){var r=this._ns;return!!this[r].appendChild(t[r])}},{key:"prepend",value:function prepend(t){var r=this._ns;return!!this[r].prependChild(t[r])}},{key:"remove",value:function remove(t){var r=this._ns;return!!this[r].removeChild(t[r])}},{key:"inject",value:function inject(t){if(t instanceof Element==0||i.test(t.tagName)||a.test(t.innerHTML))throw new Error("ensemble.Compo error: The remote object could not be resolved into a valid node.");return this.empty(),!!this[this._ns].appendChild(t)}},{key:"empty",value:function empty(){for(;this.first;)this.remove(this.first)}},{key:"children",get:function get(){return Array.prototype.map.call(this[this._ns].children,(function(t){return t.__compo}))}},{key:"first",get:function get(){var t=this._ns;return this[t].firstElementChild?this[t].firstElementChild.__compo:null}},{key:"last",get:function get(){var t=this._ns;return this[t].lastElementChild?this[t].lastElementChild.__compo:null}}]),_composition}(),o.toStringTag),h=function(t){function Data(t,r){if(_classCallCheck(this,Data),!(this instanceof Data?this.constructor:void 0))throw"ensemble.Data error: Bad invocation, must be called with new.";r&&"object"==_typeof(r)&&_extends(this,{},r);var o=this._ns="_"+t;this.__Data=!0,this[o]={ns:t}}var r,i,a;return _createClass(Data,[{key:"compo",value:function compo(t,r,o){var compo,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],c=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=this[this._ns].ns;return compo=i?{ns:l,tag:t,name:r,props:o,fresh:a,stale:c}:new u(l,t,r,o),a&&"function"==typeof a&&(compo.fresh=o.onfresh=a),c&&"function"==typeof c&&(compo.stale=o.onstale=c),compo}},{key:"render",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function _callee(t){var r;return regeneratorRuntime.wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:this[r=this._ns][t]&&this[r][t].rendered||(this[r][t]={rendered:!0,fresh:this[t].fresh,stale:this[t].stale,params:this[t]},this[t]=new u(this[t].ns,this[t].tag,this[t].name,this[t].props)),this[r][t].fresh();case 2:case"end":return o.stop()}}),_callee,this)}))),function render(t){return a.apply(this,arguments)})},{key:"stale",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(t){var r;return regeneratorRuntime.wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:this[r=this._ns][t]&&this[r][t].rendered&&this[r][t].stale();case 2:case"end":return o.stop()}}),_callee2,this)}))),function stale(t){return i.apply(this,arguments)})},{key:"reflow",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(t,r){var o;return regeneratorRuntime.wrap((function _callee3$(i){for(;;)switch(i.prev=i.next){case 0:o=this._ns,r?this[o][t]=this.compo(this[o][t].params.ns,this[o][t].params.name,this[o][t].params.props):this[o][t]&&this[o][t].rendered&&this[o][t].fresh();case 2:case"end":return i.stop()}}),_callee3,this)}))),function reflow(t,o){return r.apply(this,arguments)})},{key:t,get:function get(){return"ensemble.Data"}}],[{key:"isData",value:function isData(t){return o?o.for(t)===o.for(Data.prototype):t&&"object"==_typeof(t)&&"__Data"in t}}]),Data}(o.toStringTag),p=function(t){function Event(t,r,o){if(_classCallCheck(this,Event),!(this instanceof Event?this.constructor:void 0))throw"ensemble.Event error: Bad invocation, must be called with new.";var i=this._ns="_"+t;o=(u.isCompo(o)?o.node:o)||document,this.__Event=!0,this[i]={name:r,node:o}}return _createClass(Event,[{key:"add",value:function add(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this[this._ns].node.addEventListener(this[this._ns].name,t,r)}},{key:"remove",value:function remove(t){this[this._ns].node.removeEventListener(this[this._ns].name,t)}},{key:t,get:function get(){return"ensemble.Event"}}],[{key:"isEvent",value:function isEvent(t){return o?o.for(t)===o.for(Event.prototype):t&&"object"==_typeof(t)&&"__Event"in t}}]),Event}(o.toStringTag),d=function(){function base(){_classCallCheck(this,base);var t,r,o="ensemble"+((this instanceof base?this.constructor:void 0)&&(this instanceof base?this.constructor:void 0).name?"."+(this instanceof base?this.constructor:void 0).name:"");if(arguments.length>1?(t=arguments[0],r=arguments[1]):r=arguments[0],r&&"object"!=_typeof(r))throw new TypeError("".concat(o," error: The passed argument 'options' is not of type Object."));if(t&&"object"!=_typeof(t))throw new TypeError("".concat(o," error: The passed argument 'element' is not of type Object."));this._bindings(),this.options=this.defaults(this._defaults(),r),Object.freeze(this.options),this.element=t}return _createClass(base,[{key:"defaults",value:function defaults(t,r){var o={};for(var i in t)null!=t[i]&&"object"==_typeof(t[i])?o[i]=_extends(t[i],r[i]):o[i]=void 0!==r[i]?r[i]:t[i];return o}},{key:"compo",value:function compo(t,r,o){return null!=t?new u(this.options.ns,t,r,o):u}},{key:"data",value:function data(t){return null!=t?new h(this.options.ns,t):h}},{key:"event",value:function(t){function event(r,o){return t.apply(this,arguments)}return event.toString=function(){return t.toString()},event}((function(t,r){return"string"==typeof t?new p(this.options.ns,t,r):t?(t.preventDefault(),void t.target.blur()):p}))},{key:"selector",value:function selector(t,r){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return r=r||document,o?r.querySelectorAll(t):r.querySelector(t)}},{key:"appendNode",value:function appendNode(t,r){return!!t.appendChild(r)}},{key:"prependNode",value:function prependNode(t,r){return!!t.prependChild(r)}},{key:"removeNode",value:function removeNode(t,r){return!!t.removeChild(r)}},{key:"cloneNode",value:function cloneNode(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t.cloneNode(r)}},{key:"hasAttr",value:function hasAttr(t,r){return t.hasAttribute(r)}},{key:"getAttr",value:function getAttr(t,r){return t.getAttribute(r)}},{key:"setAttr",value:function setAttr(t,r,o){t.setAttribute(r,o)}},{key:"delAttr",value:function delAttr(t,r){t.removeAttribute(r)}},{key:"binds",value:function binds(t){var r=this;return function(o){t.call(r,o,this)}}},{key:"delay",value:function delay(t,r,o){var delay=r?this.timing(r):0;setTimeout(t,delay||o)}},{key:"timing",value:function timing(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"transitionDuration",o=u.isCompo(t)?t.getStyle(r):window.getComputedStyle(t)[r];return o&&(o=o.indexOf("s")?1e3*parseFloat(o):parseInt(o)),o||0}}]),base}(),y=function(t){_inherits(Modal,t);var r=_createSuper(Modal);function Modal(){if(_classCallCheck(this,Modal),!(this instanceof Modal?this.constructor:void 0))throw"ensemble.Modal error: Bad invocation, must be called with new.";return r.apply(this,arguments)}return _createClass(Modal,[{key:"_defaults",value:function _defaults(){return{ns:"modal",root:"body",className:"modal",fx:!0,windowed:!1,cloning:!0,backClose:!0,keyboard:!0,close:{onclick:this.close,innerText:"×",ariaLabel:"Close"},onOpen:function onOpen(){},onClose:function onClose(){},onShow:function onShow(){},onHide:function onHide(){},onContent:function onContent(){}}}},{key:"_bindings",value:function _bindings(){this.open=this.binds(this.open),this.close=this.binds(this.close),this.backx=this.binds(this.backx),this.keyboard=this.binds(this.keyboard)}},{key:"generator",value:function generator(){var t=this.options,r=this.box=this.data({onclick:!1}),o=this.box.wrap=this.compo("dialog",!1,{className:"object"==_typeof(t.className)?t.className.join(" "):t.className,hidden:!0,ariaModal:!0,role:"dialog",onclick:function onclick(){r.onclick&&"function"==typeof r.onclick&&r.onclick.apply(this,arguments)}}),i=this.cnt=this.compo(!1,"content"),a=this.compo("button",["button","close"],t.close);o.append(i),t.windowed?(o.classList.add(t.ns+"-windowed"),i.append(a)):o.append(a),t.backClose&&(this.box.onclick=this.backx),t.fx&&o.classList.add(t.ns+"-fx"),this.root=this.selector(t.root),this.built=!0}},{key:"populate",value:function populate(t){if(console.log("ensemble.Modal","populate()",t),this.element){var r=this.content(this.element);this.cnt.append(r)}}},{key:"resume",value:function resume(t){console.log("ensemble.Modal","resume()",t)}},{key:"content",value:function content(t,r){var o=this.options,i=this.compo(!1,"object"),a=(r=void 0!==r?r:o.cloning)?this.cloneNode(t,!0):t;return o.onContent.call(this,this,i,a),a&&i.inject(a),i}},{key:"destroy",value:function destroy(){var t=this.root,r=this.box.wrap;this.removeNode(t,r),this.built=!1}},{key:"open",value:function open(t,r){if(this.event(t),!this.opened){var o=this.options;this.built?this.resume(r):(this.generator(),this.populate(r)),this.opened=!0,o.onOpen.call(this,this,r,t),this.show(r),o.keyboard&&this.event("keydown").add(this.keyboard),console.log("ensemble.Modal","open()",this)}}},{key:"close",value:function close(t,r){if(this.event(t),this.opened){var o=this.options;this.opened=!1,o.onClose.call(this,this,r,t),this.hide(r),o.keyboard&&this.event("keydown").remove(this.keyboard),console.log("ensemble.Modal","close()",this)}}},{key:"show",value:function show(t){var r=this.options,o=this.root;this.box;var i=this.box.wrap;i.install(o),this.delay((function(){i.show(),r.onShow.call(self,self,t)}))}},{key:"hide",value:function hide(t){var r=this.options,o=this.root;this.box;var i=this.box.wrap;i.hide(),this.delay((function(){i.uninstall(o),r.onHide.call(self,self,t)}),i,300)}},{key:"backx",value:function backx(t){this.event(t);var r,o=t.target,i=o.parentElement,a=this.options.ns;if(((r=new RegExp(a+"-content")).test(o.className)||r.test(i.className))&&(console.log("ensemble.Modal","backx()","outside cropbox area",":then: close",i,o),this.close(t)),(r=new RegExp(a+"-object")).test(o.className)){var c=o.firstElementChild,l=c.offsetWidth,u=c.offsetHeight,h=o.offsetTop,p=o.offsetLeft,d=o.offsetWidth,y=o.offsetHeight,v=event.x,m=event.y,_=(y-u)/2,b=(d-l)/2,g=_+u,k=b+l;console.log("ensemble.Modal","backx()","coords",{x:v,y:m},{target_t:h,target_l:p,target_w:d,target_h:y},{crop_t:_,crop_r:k,crop_b:g,crop_l:b}),(m>h||v>p||v<d||m<y)&&(m<_||v>k||m>g||v<b)&&(console.log("ensemble.Modal","backx()","outside cropbox area",":then: close",i,o),this.close(t))}else console.log("ensemble.Modal","backx()","outside cropbox area",":then: skip",i,o)}},{key:"keyboard",value:function keyboard(t){this.event(t),27==(t.keyCode||0)&&this.close(t)}}]),Modal}(d);t.Modal=y}));